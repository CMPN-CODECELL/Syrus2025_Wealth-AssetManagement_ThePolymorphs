{
  "_id": "0be4fa6d-7695-45c6-b4d7-28bc3023d082",
  "aiPersonaId": "8c1f2df4-2053-4020-8cb8-3b77757a6f4d",
  "integrationId": "ma-document-processing-agent-9163-primary-workflow-for-document-processing-agent",
  "isMiniAgentPrimaryWorkflow": true,
  "name": "Primary Workflow for Document Processing Agent",
  "publisherAccountId": "c7fc4684-139f-4cf7-a9e5-10f08cfed9b0",
  "startTaskId": "e877c6f6-1116-4be1-b0f9-fd22c96d9294",
  "status": "Active",
  "tasks": [
    {
      "_id": "e877c6f6-1116-4be1-b0f9-fd22c96d9294",
      "type": "PassThrough",
      "config": {
        "name": "Pass Through",
        "description": "Pass through the input to the output"
      },
      "transitions": [
        {
          "_id": "2cb4e4e6-828c-44ec-b805-3f9ce68aaef7-e877c6f6-1116-4be1-b0f9-fd22c96d9294",
          "nextTask": "2cb4e4e6-828c-44ec-b805-3f9ce68aaef7",
          "name": "If query doesnt exists",
          "rules": [
            {
              "type": "any",
              "operator": "notExists",
              "path": "$output.query"
            }
          ]
        },
        {
          "_id": "8c50aac1-0a5f-486f-8b19-c192b797d4ac-e877c6f6-1116-4be1-b0f9-fd22c96d9294",
          "nextTask": "8c50aac1-0a5f-486f-8b19-c192b797d4ac",
          "name": "If intents are already classified",
          "rules": [
            {
              "type": "any",
              "operator": "exists",
              "path": "$output.intents"
            },
            {
              "type": "any",
              "operator": "exists",
              "path": "$output.query"
            }
          ]
        },
        {
          "_id": "e877c6f6-1116-4be1-b0f9-fd22c96d9294-c126f76a-7fc2-49ba-8156-27ccadd54608",
          "name": "If query exists",
          "nextTask": "c126f76a-7fc2-49ba-8156-27ccadd54608",
          "rules": [
            {
              "type": "any",
              "operator": "exists",
              "path": "$output.query"
            },
            {
              "type": "any",
              "operator": "notExists",
              "path": "$output.intents"
            }
          ]
        }
      ],
      "globalVariables": [
        {
          "name": "query",
          "referencePath": "$input.query"
        },
        {
          "name": "rawQuery",
          "referencePath": "$input.rawQuery"
        },
        {
          "name": "conversationId",
          "referencePath": "$input.conversationId"
        }
      ]
    },
    {
      "_id": "2cb4e4e6-828c-44ec-b805-3f9ce68aaef7",
      "type": "Input",
      "config": {
        "name": "User Input",
        "description": "Get user input",
        "type": "string"
      },
      "transitions": [
        {
          "_id": "2cb4e4e6-828c-44ec-b805-3f9ce68aaef7-c126f76a-7fc2-49ba-8156-27ccadd54608",
          "name": "Default",
          "nextTask": "c126f76a-7fc2-49ba-8156-27ccadd54608"
        }
      ],
      "globalVariables": [
        {
          "name": "query",
          "referencePath": "$output.userInput"
        },
        {
          "name": "rawQuery",
          "referencePath": "$output.userInput"
        },
        {
          "name": "selfLoopMiniAgent",
          "referencePath": "true"
        }
      ]
    },
    {
      "_id": "c126f76a-7fc2-49ba-8156-27ccadd54608",
      "type": "Loader",
      "config": {
        "name": "Loader",
        "description": "Display loader message",
        "type": "loader",
        "text": "Just a moment... identifying the best approach to assist you."
      },
      "transitions": [
        {
          "_id": "c126f76a-7fc2-49ba-8156-27ccadd54608-0a0242b2-85bf-4ea0-8edb-1dd1dcc08b07",
          "name": "Default",
          "nextTask": "0a0242b2-85bf-4ea0-8edb-1dd1dcc08b07"
        }
      ]
    },
    {
      "_id": "0a0242b2-85bf-4ea0-8edb-1dd1dcc08b07",
      "type": "IntentClassification",
      "config": {
        "name": "Intent Classification",
        "description": "Classify the intent of the user message",
        "modelId": "4cf651d9-edf3-455f-a22e-53cc67fcc07b",
        "intents": [
          {
            "name": "Invoice Summarizer",
            "description": "This intent analyzes portfolio PDFs using the Portfolio Analysis sub-agent. It extracts key investment data and returns a standardized JSON for further processing and rebalancing.\n\nPurpose:\nExtract structured financial data from a portfolio PDF to assess performance, risks, and rebalancing opportunities.\n\nKey Details to Extract:\n\nPortfolio Metadata:\n\nPortfolio ID, Report Date, Currency\n\nInvestment Holdings:\n\nAsset Name, Type (Stocks, Bonds, ETFs, etc.), Ticker, Quantity, Purchase Price, Current Price, Market Value\n\nPerformance Metrics:\n\nUnrealized Gains/Losses, Percentage Change, Dividend Income, Yield\n\nRisk & Allocation:\n\nSector Distribution, Asset Allocation, Diversification Insights\n\nFinancial Summary:\n\nTotal Portfolio Value, Net Gain/Loss, Benchmark Performance, Rebalancing Suggestions\n\nAdditional Info:\n\nInvestment Notes, Future Actionable Insights",
            "examples": [
              "Analyze my portfolio PDF and give me a summary of my investments.",
              "Extract key details from my investment portfolio document.",
              "Upload my portfolio statement and provide insights on asset allocation.",
              "Break down my stock holdings from this portfolio file.",
              "Check my portfolio PDF and tell me if I need to rebalance."
            ]
          }
        ],
        "query": "$agent.query"
      },
      "transitions": [
        {
          "_id": "0a0242b2-85bf-4ea0-8edb-1dd1dcc08b07-8c50aac1-0a5f-486f-8b19-c192b797d4ac",
          "name": "If Intent is Matched",
          "rules": [
            {
              "type": "string",
              "operator": "equal",
              "path": "$output.intentMatched",
              "value": "true"
            }
          ],
          "nextTask": "8c50aac1-0a5f-486f-8b19-c192b797d4ac"
        },
        {
          "_id": "0a0242b2-85bf-4ea0-8edb-1dd1dcc08b07-66c1be51-f3dd-4b0d-9a67-a8949198a61e",
          "name": "If No Intent is Matched",
          "rules": [
            {
              "type": "string",
              "operator": "equal",
              "path": "$output.intentMatched",
              "value": "false"
            }
          ],
          "nextTask": "66c1be51-f3dd-4b0d-9a67-a8949198a61e"
        }
      ]
    },
    {
      "_id": "8c50aac1-0a5f-486f-8b19-c192b797d4ac",
      "type": "JSFunction",
      "config": {
        "name": "JS Function",
        "description": "Execute JS function",
        "code": "\nconst main = () => {\n    const currentExecutionId = _id;\n    const intents = agent?.icIntents?.[currentExecutionId] || input.intents;\n    const currentIndex = agent?.icLoopIndexes?.[currentExecutionId] || 0;\n    const currentIntent = intents[currentIndex] || {};\n    const { intent, task } = currentIntent;\n    const state = currentIndex === intents.length ? 'end' : 'continue'\n    const icLoopIndexes = { ...(agent?.icLoopIndexes || {}), [_id]: state === 'end' ? undefined : currentIndex + 1 };\n    const icIntents = { ...(agent?.icIntents || {}), [_id]: state === 'end' ? undefined : intents };\n    return { ...input, intent, state: currentIndex === intents.length ? 'end' : 'continue', icLoopIndexes, icIntents, query: task };\n};\n\nmain()\n"
      },
      "globalVariables": [
        {
          "referencePath": "$output.icLoopIndexes",
          "name": "icLoopIndexes"
        },
        {
          "referencePath": "$output.icIntents",
          "name": "icIntents"
        }
      ],
      "transitions": [
        {
          "_id": "8c50aac1-0a5f-486f-8b19-c192b797d4ac-93d040ad-187b-4221-858c-5615c3429446",
          "name": "If Intent is Matched",
          "rules": [
            {
              "type": "string",
              "operator": "equal",
              "path": "$output.intent",
              "value": "Invoice Summarizer"
            }
          ],
          "nextTask": "93d040ad-187b-4221-858c-5615c3429446"
        },
        {
          "_id": "8c50aac1-0a5f-486f-8b19-c192b797d4ac-2cb4e4e6-828c-44ec-b805-3f9ce68aaef7",
          "name": "If Self Loop",
          "rules": [
            {
              "type": "string",
              "operator": "equal",
              "path": "$agent.selfLoopMiniAgent",
              "value": "true"
            },
            {
              "type": "string",
              "operator": "equal",
              "path": "$output.state",
              "value": "end"
            }
          ],
          "nextTask": "2cb4e4e6-828c-44ec-b805-3f9ce68aaef7"
        }
      ]
    },
    {
      "_id": "93d040ad-187b-4221-858c-5615c3429446",
      "type": "Workflow",
      "config": {
        "name": "Intent - Invoice Summarizer",
        "description": "Workflow for intent - Invoice Summarizer",
        "workflowId": "331991fd-0be2-4d10-bab6-27e51031ae6d"
      },
      "transitions": [
        {
          "_id": "93d040ad-187b-4221-858c-5615c3429446-8c50aac1-0a5f-486f-8b19-c192b797d4ac",
          "name": "Mini agent execution completed",
          "nextTask": "8c50aac1-0a5f-486f-8b19-c192b797d4ac"
        }
      ]
    },
    {
      "_id": "66c1be51-f3dd-4b0d-9a67-a8949198a61e",
      "transitions": [
        {
          "_id": "66c1be51-f3dd-4b0d-9a67-a8949198a61e-2cb4e4e6-828c-44ec-b805-3f9ce68aaef7",
          "name": "If Self Loop",
          "rules": [
            {
              "type": "string",
              "operator": "equal",
              "path": "$agent.selfLoopMiniAgent",
              "value": "true"
            }
          ],
          "nextTask": "2cb4e4e6-828c-44ec-b805-3f9ce68aaef7"
        }
      ],
      "type": "Output",
      "config": {
        "name": "Output",
        "description": "Output the response to the user",
        "type": "external",
        "text": "Unable to complete task $agent.query"
      }
    },
    {
      "_id": "3ea75749-82c4-42e3-9d8f-b5f67057397f",
      "transitions": [
        {
          "_id": "3ea75749-82c4-42e3-9d8f-b5f67057397f-2cb4e4e6-828c-44ec-b805-3f9ce68aaef7",
          "name": "If Self Loop",
          "rules": [
            {
              "type": "string",
              "operator": "equal",
              "path": "$agent.selfLoopMiniAgent",
              "value": "true"
            }
          ],
          "nextTask": "2cb4e4e6-828c-44ec-b805-3f9ce68aaef7"
        }
      ],
      "type": "Display",
      "config": {
        "name": "Display",
        "description": "Display the response to the user",
        "type": "text",
        "text": "$input.content"
      }
    }
  ],
  "type": "Conversational",
  "version": "latest"
}